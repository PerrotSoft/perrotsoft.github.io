<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Account settings</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="icon" href="img/ico.ico" type="image/x-icon">
    <link rel="stylesheet" href="css/style1.css">
    <script src="js/sitefun.js" type="module"></script>
    <style>
        /* Основные стили */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #F2F2F2;
            margin: 0;
            padding: 0;
        }

        header {
            position: fixed;
            background-color: #1A73E8;
            padding: 20px;
            color: white;
            text-align: center;
            font-size: 35px;
            width: 100%;
            height: 5%;
            top: 0; /* Убедимся, что header сверху */
            left: 0;
            z-index: 900;
        }

        nav {
            background-color: #ffffff;
            width: 200px;
            padding: 10px;
            box-shadow: 2px 0 5px rgba(0, 0, 0, 0.1);
            position: fixed;
            height: 100%;
            overflow-y: scroll;
            top: 0;
            left: 0;
        }

        /* **ИЗМЕНЕНИЕ: Стиль ссылок для размещения иконки** */
        nav a {
            text-decoration: none;
            display: flex; /* Используем flex для выравнивания */
            align-items: center; /* Центрируем иконку и текст вертикально */
            margin: 10px 0;
            color: #1A73E8;
            font-size: 18px;
            padding: 5px 0;
            gap: 8px; /* Расстояние между иконкой и текстом */
        }

        nav a:hover {
            text-decoration: underline;
        }

        /* **НОВЫЙ СТИЛЬ: Мини-иконка в списке навигации** */
        .nav-article-icon {
            width: 20px;
            height: 20px;
            object-fit: cover; /* Иконка будет заполнять область */
            border-radius: 4px;
            flex-shrink: 0; /* Не даем иконке сжиматься */
        }

        .main-content {
            margin-left: 270px; /* 200px nav + 55px article-actions + 15px gap */
            padding: 20px;
            flex-grow: 1;
            min-height: 100vh; /* Минимальная высота, чтобы футер был внизу */
        }

        h2 {
            color: #333;
        }

        footer {
            background-color: #00ff62;
            padding: 10px;
            position: fixed;
            text-align: center;
            color: #000000;
            font-size: 14px;
            width: 100%;
            bottom: 0;
            z-index: 900;
        }

        /* Стили для изображения страницы */
        .page-image {
            max-width: 100%;
            height: auto;
            margin: 20px 0;
            display: block;
            border-radius: 8px; /* Добавлен небольшой радиус */
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        #535435 {
            display: none;
            left: 20px;
            top: 20px;
        }

        #bib1 {
            left: 15px;
            top: 15px;
        }

        /* **СТИЛИ: Мини-иконки для статьи (Desktop only)** */
        .article-actions {
            position: fixed;
            left: 215px; /* На 15px правее nav (200px) */
            top: 150px; /* Отступ сверху */
            width: 40px;
            z-index: 500;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        /* mcss: боковая навигация для datapedia.html с кнопкой скрытия/открытия */
        @media (max-width: 768px) {
            nav {
                position: fixed;
                left: 0;
                top: 0;
                width: 70vw;
                max-width: 260px;
                min-width: 140px;
                height: 100vh;
                background: #fff;
                box-shadow: 2px 0 8px rgba(0, 0, 0, 0.08);
                transform: translateX(-100%);
                transition: transform 0.3s;
                padding: 12px 8px 8px 8px;
            }

            nav.active {
                transform: translateX(0);
            }

            .toggleMenuBtn {
                position: fixed;
                top: 12px;
                left: 12px;
                z-index: 1100;
                background: #1A73E8;
                color: #fff;
                border: none;
                border-radius: 6px;
                font-size: 28px;
                width: 44px;
                height: 44px;
                display: flex;
                align-items: center;
                justify-content: center;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
                cursor: pointer;
            }

            .main-content {
                padding: 60px 2vw 12px 2vw; 
                margin-left: 0 !important;
                width: 100vw;
                min-height: 60vh;
                box-sizing: border-box;
                overflow-y: visible;
            }

            #pageList a {
                font-size: 16px;
                padding: 7px 0;
                margin: 2px 0;
            }

            #535435 {
                display: block;
            }

            #bib1 {
                left: 65px;
                top: 12px; /* Выровнен с toggleMenuBtn */
                z-index: 1100;
            }
        }
    </style>
</head>
<body>
    <button class="toggleMenuBtn" id="535435" onclick="toggleNavMenu()">></button>

    <div>
        <button class="toggleButton" id="bib1" onclick="toggleMenu()">☰</button>
        <div class="user-widget" onclick="toggleUserMenu()">
            <img class="user-icn" src="https://cdn-icons-png.flaticon.com/128/17807/17807725.png" alt="Иконка профиля">
            <div class="user-widget-info">
                <div class="name">User Name</div>
                <div class="email"></div>
                <div class="pcoin">Pcoin 0</div>
            </div>
        </div>
        <div class="user-menu" id="userMenu" style="display: none;">
            <button onclick="window.location.href='accunt'">Setings</button>
            <button onclick="window.location.href='accunt'">top up balance Pcoin</button>
            <button onclick="window.location.href='riegist'">register or login</button>
        </div>
        <div class="menuContainer" id="menuContainer">
            <div class="appItem">
                <form action="results.html" method="get">
                    <input type="text" name="query" placeholder="Enter your query" style="width: 70px ;height: 10px;" required>
                    <button type="submit" style="height: 40px;width: 80px;">Search</button>
                </form>
            </div>
            <div class="appItem" onclick="openApp('PerrotSoft-Play')">
                <i class="fab fa-google-play appIcon"></i>
                <span>Play</span>
            </div>
            <div class="appItem" onclick="openApp('https://perrotsoft.github.io/')">
                <img src="img/Home.png" alt="png">
                <span>Home</span>
            </div>
            <div class="appItem" onclick="openApp('Install_PerrotOS')">
                <img src="img/ico1.png" alt="png">
                <span>install OS</span>
            </div>
            <div class="appItem" onclick="openApp('datapedia')">
                <img src="img/datapedia icon1.png" alt="png">
                <span>dataPedia</span>
            </div>
            <div class="appItem" onclick="openApp('https://wavychatapp.github.io/')">
                <img src="https://wavychatapp.github.io/WavyChatApp.ico" width="30px" height="30px" alt="png">
                <span>WavyChatApp</span>
            </div>
            <div class="appItem" onclick="openApp('accunt')">
                <img src="img/as.png" alt="png">
                <span>Account settings.</span>
            </div>
            <div class="appItem" onclick="openApp('ParrotSoft_Apps')">
            <img src="img/Apps.png" width="30px" height="30px" alt="png">
            <span>ParrotSoft Apps</span>
        </div><div class="appItem" onclick="openApp('pdrive')">
            <svg width="30" height="30" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                <path d="M16.5 13C18.433 13 20 11.433 20 9.5C20 7.74619 18.7397 6.27318 17.0706 6.04693C16.5925 3.39572 14.129 1 11 1C7.81792 1 5.30822 3.44494 4.88785 6.13689C2.79374 6.70321 1 8.87851 1 11.5C1 14.0044 2.80931 16 5 16H18C19.6569 16 21 14.6569 21 13C21 11.6667 19.9678 10.5518 18.5 10.1557" fill="#1A73E8"/>
                
                <path d="M10 18L14.5 14L15.5 15.5L13 18H10Z" fill="#34A853"/>
                <path d="M13 18L16 22L20 18H13Z" fill="#4285F4"/>
                <circle cx="15.5" cy="16.5" r="1.5" fill="#FFFFFF"/>
                <path d="M12 21C12 21.5523 11.5523 22 11 22C10.4477 22 10 21.5523 10 21C10 20.4477 10.4477 20 11 20C11.5523 20 12 20.4477 12 21Z" fill="#FBBC04"/>
                
                <path d="M5 11.5C5 9.84315 6.34315 8.5 8 8.5C9.65685 8.5 11 9.84315 11 11.5V11.5C11 13.1569 9.65685 14.5 8 14.5C6.34315 14.5 5 13.1569 5 11.5Z" fill="#FFFFFF" opacity="0.3"/>

            </svg>
            <span>ParrotSoft Drive</span>
        </div>
        </div>
    </div>

    <nav onclick="toggleNavMenu()"> 
        <div style="height: 25px;margin-top: 25px;"></div>
        <input type="text" style="width: 90%;" placeholder="Поиск..." id="searchInput" oninput="filterPages(event)">
        <div id="pageList">
            </div>
    </nav>

    <div class="main-content" id="mainContent">
    </div>

    <div style="height: 40px;margin-top: 40px;"></div>
<script src="js/user.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
<script type="module">
import "./js/firebase_db.js";
import { PDrive } from "./js/PDrive.js";
const data = {
        "title": "DataPedia",
        "pages": {
            "P-Sharp coding": {
                "title": "P-Sharp",
                "image": "img/ico1.png",
                "content": "<h2>Информация о P-Sharp</h2><p>Язык P Sharp основан в 2025 году...</p>"
            },
            "ParrotSoft": {
                "title": "ParrotSoft",
                "image": "img/ico1.png",
                "content": "<p>ParrotSoft - это компания, основанная в начале 2024 года...</p>"
            }
        }
    };
    
    // Загрузка и расширение списка сайтов
    (async function () {
        try {
            const username = getCookie('name') || 'guest';
    
            // 1. Инициализируем PDrive для текущего пользователя
            const pdrive = new PDrive(username); 
            await pdrive.init(); 

            // 2. Получаем все проектные файлы с расширением ".ppdatapedia"
            const projectFiles = await pdrive.get_progect_files(",ppdatapedia") || [];
            console.log("Найденные файлы проекта:", projectFiles);

            // 3. Итерируем по всем найденным файлам и объединяем их содержимое
            let combinedFileContent = "";
            
            projectFiles.forEach(entry => {
                // Убеждаемся, что entry.file.value существует и является строкой
                if (entry.file && typeof entry.file.value === 'string') {
                    // ИСПРАВЛЕНИЕ: Используем '|' как разделитель между файлами, 
                    // так как страницы внутри файла также разделены '|'
                    combinedFileContent += entry.file.value + '|'; 
                    console.log(`Добавлен файл проекта от пользователя ${entry.user}: ${entry.file.name}`);
                }
            });

            // 4. Разбиваем объединенное содержимое на отдельные определения страниц
            const pageDefinitions = combinedFileContent.split('|').filter(part => part.trim() !== '');
            
            pageDefinitions.forEach(part => {
                const f = part.trim().split('~');
                // Проверяем, что есть как минимум заголовок и путь к изображению
                if (f.length >= 2) { 
                    const key = f[0];
                    const newPage = {
                        title: f[0],
                        image: f[1],
                        content: f[2] || '<p>Нет информации</p>'
                    };

                    // Добавление в объект pages по ключу
                    data.pages[key] = newPage;
                }
            });

            console.log("Known sites loaded:", data.pages);

            updatePageList();

            // Автоматическое отображение страницы "ParrotSoft"
            if (data.pages['ParrotSoft']) {
                showPage(data.pages['ParrotSoft']);
            }

        } catch (error) {
            console.error("Ошибка при загрузке сайтов:", error);
        }
    })();

    const pages = data.pages;
    const pageList = document.getElementById('pageList');
    const mainContent = document.getElementById('mainContent');
    const searchInput = document.getElementById('searchInput');

    // **ИЗМЕНЕНИЕ: Добавлена логика в filterPages для создания иконки**
    function filterPages(e) {
        const query = e.target.value.toLowerCase();
        const filteredPages = Object.keys(pages).filter(pageName =>
            pages[pageName].title.toLowerCase().includes(query)
        );

        pageList.innerHTML = '';
        filteredPages.forEach(pageName => {
            const page = pages[pageName];
            const pageLink = document.createElement('a');
            pageLink.href = '#';

            // Добавление мини-иконки
            if (page.image) {
                const iconImg = document.createElement('img');
                iconImg.src = page.image;
                iconImg.alt = page.title;
                iconImg.classList.add('nav-article-icon');
                pageLink.appendChild(iconImg);
            }

            // Добавление текста
            const titleText = document.createTextNode(page.title);
            pageLink.appendChild(titleText);
            
            pageLink.addEventListener('click', () => {
                showPage(page);
                if (window.innerWidth <= 768) {
                    toggleNavMenu(); 
                }
            });
            pageList.appendChild(pageLink);
        });
    }

    // Отображение страницы
    function showPage(page) {
        let imageHtml = "";
        if (page.image) {
            imageHtml = `<img src="${page.image}" alt="${page.title}" class="page-image">`;
        }
        mainContent.innerHTML = `
            <div style="height: 30px;margin-top: 30px;"></div>
                <h2>${page.title}</h2>
                ${imageHtml}
                <div>${page.content}</div>
            `;
    }

    // **ИЗМЕНЕНИЕ: Добавлена логика в updatePageList для создания иконки**
    function updatePageList() {
        pageList.innerHTML = '';
        Object.keys(pages).forEach(pageName => {
            const page = pages[pageName];
            const pageLink = document.createElement('a');
            pageLink.href = '#';

            // Добавление мини-иконки
            if (page.image) {
                const iconImg = document.createElement('img');
                iconImg.src = page.image;
                iconImg.alt = page.title;
                iconImg.classList.add('nav-article-icon');
                pageLink.appendChild(iconImg);
            }

            // Добавление текста
            const titleText = document.createTextNode(page.title);
            pageLink.appendChild(titleText);
            
            pageLink.addEventListener('click', () => {
                showPage(page);
                if (window.innerWidth <= 768) {
                    toggleNavMenu();
                }
            });
            pageList.appendChild(pageLink);
        });
    }
    
    function toggleNavMenu() {
        const nav = document.querySelector('nav');
        nav.classList.toggle('active');
    }
    </script>
</body>
</html>